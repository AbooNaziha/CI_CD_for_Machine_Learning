name: Continuous Integration 
on: 
    push: 
      branches: [ "main"]
    pull_request:
      branches: [ "main" ]
    workflow_dispatch:
    
permissions: write-all
jobs: 
  build: 
     name: deploy to staging
     runs-on: ubuntu-latest
     container: docker:/dvcorg/cml-py3:latest
     steps:
        - uses: actions/checkout@v4
        - name: Use Node.js ${{ matrix.node_version }}
        - uses: actions/setup-node@v4
          with:
            node-version: ${{ matrix.node_version }}
        - name: npm install, build and test
          run: |
            npm install
            npm run build --if-present
            npm test
        - name: Install Packeges
        - run: make install
        - name: Format
        - run: make format
        - name: Train
        - run: make train
        - name: Evaluation
          env: 
            REPO_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          run: make eval
          
        
        
     
